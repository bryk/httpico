<html><head><title>Piotr Bryk - Systemy operacyjne - dokumentacja projektu &quot;Serwer HTTP&quot;</title><style type="text/css">ol{margin:0;padding:0}.c17{vertical-align:top;width:648pt;border-style:solid;border-color:#000000;border-width:1pt;padding:5pt 5pt 5pt 5pt}.c7{list-style-type:decimal;margin:0;padding:0}.c18{max-width:648pt;background-color:#ffffff;padding:72pt 72pt 72pt 72pt}.c2{padding-left:0pt;direction:ltr;margin-left:36pt}.c9{list-style-type:disc;margin:0;padding:0}.c5{font-size:36pt;font-weight:bold}.c0{height:12pt;direction:ltr}.c10{color:inherit;text-decoration:inherit}.c6{font-size:14pt;font-weight:bold}.c4{color:#1155cc;text-decoration:underline}.c11{padding-left:-3.8pt;margin-left:16.5pt}.c14{text-align:center}.c12{font-style:italic}.c13{margin-left:18pt}.c3{line-height:1.0}.c16{margin-left:36pt}.c1{font-family:"Courier New"}.c15{border-collapse:collapse}.c8{direction:ltr}.title{padding-top:24pt;line-height:1.15;text-align:left;color:#000000;font-size:36pt;font-family:"Arial";font-weight:bold;padding-bottom:6pt}.subtitle{padding-top:18pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:24pt;font-family:"Georgia";padding-bottom:4pt}li{color:#000000;font-size:12pt;font-family:"Arial"}p{color:#000000;font-size:12pt;margin:0;font-family:"Arial"}h1{padding-top:24pt;line-height:1.15;text-align:left;color:#000000;font-size:18pt;font-family:"Arial";font-weight:bold;padding-bottom:6pt}h2{padding-top:18pt;line-height:1.15;text-align:left;color:#000000;font-size:14pt;font-family:"Arial";font-weight:bold;padding-bottom:4pt}h3{padding-top:14pt;line-height:1.15;text-align:left;color:#000000;font-size:12pt;font-family:"Arial";font-weight:bold;padding-bottom:4pt}h4{padding-top:12pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:11pt;font-family:"Arial";padding-bottom:2pt}h5{padding-top:11pt;line-height:1.15;text-align:left;color:#666666;font-size:10pt;font-family:"Arial";font-weight:bold;padding-bottom:2pt}h6{padding-top:10pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:10pt;font-family:"Arial";padding-bottom:2pt}</style></head><body class="c18"><p class="c14 c8"><img height="473" src="images/image01.jpg" width="243"></p><p class="c14 c8"><span class="c5">Serwer HTTP &ldquo;httpico&rdquo;</span></p><p class="c8 c14"><span class="c6">Dokumentacja projektu </span></p><p class="c0"><span class="c6"></span></p><p class="c8"><span class="c6">Przedmiot:</span></p><p class="c8"><span>Systemy operacyjne</span></p><p class="c0"><span></span></p><p class="c8"><span class="c6">Kierunek, rok studi&oacute;w:</span></p><p class="c8"><span>Informatyka, rok II (2011/2012 - semestr letni)</span></p><p class="c0"><span></span></p><p class="c8"><span class="c6">Autor:</span></p><p class="c8"><span>Piotr Bryk, </span><span class="c4"><a class="c10" href="mailto:piotrek.bryk@gmail.com">piotrek.bryk@gmail.com</a></span><span>&nbsp;</span></p><p class="c0"><span></span></p><hr style="page-break-before:always;display:none;"><p class="c0"><span></span></p><p class="c13 c8"><span class="c4"><a class="c10" href="#h.1vpl7ddhxgwt">Za&#322;o&#380;enia projektu</a></span></p><p class="c13 c8"><span class="c4"><a class="c10" href="#h.a2jlk0r8af4k">Wykorzystane narz&#281;dzia</a></span></p><p class="c8 c13"><span class="c4"><a class="c10" href="#h.xxkwoijb6adj">Architektura programu</a></span></p><p class="c16 c8"><span class="c4"><a class="c10" href="#h.w96h8cg535d">Konfiguracja</a></span></p><p class="c16 c8"><span class="c4"><a class="c10" href="#h.gmcmvq8rnsmp">Logowanie</a></span></p><p class="c16 c8"><span class="c4"><a class="c10" href="#h.ypapygt3ifx4">System szablon&oacute;w</a></span></p><p class="c8 c16"><span class="c4"><a class="c10" href="#h.he9n0setq17y">Strony b&#322;&#281;d&oacute;w</a></span></p><p class="c16 c8"><span class="c4"><a class="c10" href="#h.ycu3r9aiznhj">Obs&#322;ugiwane pliki</a></span></p><p class="c13 c8"><span class="c4"><a class="c10" href="#h.jzblj6bjdy1j">Uruchamianie i instalacja</a></span></p><hr><p class="c0"><span></span></p><p class="c0"><span></span></p><ol class="c7" start="1"><li class="c11 c8"><h2><a name="h.1vpl7ddhxgwt"></a><span>Za&#322;o&#380;enia projektu</span></h2></li></ol><p class="c8"><span>Tre&#347;&#263; tematu projektu wymaga&#322;a aby stworzony serwer HTTP zawiera&#322; nast&#281;puj&#261;ce funkcjonalno&#347;ci:</span></p><ol class="c9" start="1"><li class="c2"><span>konfiguracja w pliku tekstowym</span></li><li class="c2"><span>logowanie aktywno&#347;ci do plik&oacute;w *.log</span></li><li class="c2"><span>wykorzystanie socket&oacute;w i w&#261;tk&oacute;w </span></li><li class="c2"><span>obs&#322;uga zapyta&#324; GET i POST </span></li><li class="c2"><span>obs&#322;uga standardowych kod&oacute;w odpowiedzi</span></li><li class="c2"><span>realizacja obiektowa w j&#281;zyku C++</span></li><li class="c2"><span>obs&#322;uga popularnych sygna&#322;&oacute;w systemowych (np. SIGINT)</span></li></ol><p class="c0"><span></span></p><p class="c8"><span>Wszystkie wy&#380;ej wymienione punkty zosta&#322;y zrealizowane, a ponadto w celu zwi&#281;kszenia u&#380;yteczno&#347;ci tworzonego serwera zosta&#322;y zaimplementowane dodatkowe funkcjonalno&#347;ci kt&oacute;re nie by&#322;y wymagane w temacie projektu. S&#261; to mi&#281;dzy innymi:</span></p><ol class="c9" start="1"><li class="c2"><span>wy&#347;wietlanie listy plik&oacute;w katalog&oacute;w (tzw. strony </span><span class="c12">index of</span><span>) </span></li><li class="c2"><span>prosty system szablon&oacute;w u&#380;ywanych podczas tworzenia stron b&#322;&#281;d&oacute;w i listowania katalog&oacute;w</span></li><li class="c2"><span>mo&#380;liwo&#347;&#263; kompilacji serwera do wersji </span><span class="c12">embedded</span><span>, kt&oacute;ra wszystkie potrzebne dane pobiera z katalogu bie&#380;&#261;cego, dzi&#281;ki czemu mo&#380;e by&#263; uruchamiana np. z dysku USB </span></li><li class="c2"><span>mo&#380;liwo&#347;&#263; kompilacji serwera z w&#322;&#261;czonymi lub wy&#322;&#261;czonymi komunikatami diagnostycznymi przydatnymi podczas znajdowania b&#322;&#281;d&oacute;w </span></li><li class="c2"><span>przeno&#347;no&#347;&#263;, mo&#380;liwo&#347;&#263; &#322;atwej instalacji i kompilacji dzi&#281;ki u&#380;yciu zestawu narz&#281;dzi programistycznych </span><span class="c12">autotools</span><span>&nbsp;</span></li></ol><p class="c0"><span></span></p><p class="c8"><span>Ponadto, projekt zosta&#322; wydany na licencji </span><span class="c12">open source </span><span>Apache 2.0 i jego kod &#378;r&oacute;d&#322;owy jest dost&#281;pny pod adresem: </span><span class="c4"><a class="c10" href="https://bitbucket.org/bryq/httpico">https://bitbucket.org/bryq/httpico</a></span><span>. Daje to nadziej&#281;, &#380;e projekt nie zostanie zako&#324;czony wraz z ko&#324;cem przedmiotu, lecz zostanie kontynuowany w ramach wolnego czasu.</span></p><ol class="c7" start="2"><li class="c8 c11"><h2><a name="h.a2jlk0r8af4k"></a><span>Wykorzystane narz&#281;dzia</span></h2></li></ol><p class="c8"><span>W projekcie zosta&#322;y wykorzystane tylko standardowe biblioteki j&#281;zyka C++ i systemu UNIX. Dzi&#281;ki temu serwer jest bardzo przeno&#347;ny i szybki, jednak skomplikowa&#322;o to znacznie jego implementacj&#281;, poniewa&#380; parsowanie i analiza tekstu musia&#322;y zosta&#263; zrealizowane bez u&#380;ycia wyra&#380;e&#324; regularnych. Ponadto, zarz&#261;dzanie pami&#281;ci&#261; musia&#322;o odbywa&#263; si&#281; r&#281;cznie, poniewa&#380; nie zosta&#322; wykorzystany &#380;aden </span><span class="c12">garbage collector</span><span>&nbsp;ani mechanizm </span><span class="c12">smart pointers</span><span>. </span></p><p class="c0"><span></span></p><p class="c8"><span>Projekt zosta&#322; stworzony przy u&#380;yciu rozproszonego systemu kontroli wersji </span><span class="c12">git</span><span>&nbsp;z serwerem na darmowej platformie </span><span class="c4"><a class="c10" href="https://bitbucket.org">https://bitbucket.org</a></span><span>. Na &#347;rodowisko programistyczne zosta&#322;o wybrane Eclipse wraz z zestawem wtyczek do wspomagania pracy z j&#281;zykiem C++ i systemem kontroli wersji. </span></p><p class="c0"><span></span></p><p class="c8"><span>Jako system kompilacji i instalacji zosta&#322; wybrany Linuksowy zestaw narz&#281;dzi </span><span class="c12">autotools</span><span>.</span></p><ol class="c7" start="3"><li class="c11 c8"><h2><a name="h.xxkwoijb6adj"></a><span>Architektura programu</span></h2></li></ol><h3 class="c8"><a name="h.w96h8cg535d"></a><span>Konfiguracja</span></h3><p class="c8"><span>Gdy serwer jest skompilowany w wersji </span><span class="c12">embedded, </span><span>to poszukuje on pliku konfiguracyjnego w bie&#380;&#261;cym</span><span>&nbsp;katalogu. Ponadto, je&#347;li w pliku konfiguracyjnym opcja kt&oacute;ra przyjmuj&#281; &#347;cie&#380;k&#281; katalogu nie zostanie okre&#347;lona, to serwer zak&#322;ada &#380;e jest to bie&#380;&#261;cy katalog. </span></p><p class="c0"><span></span></p><p class="c8"><span>Gdy serwer jest skompilowany w wersji standardowej, to poszukuje on pliku </span><span class="c12">httpico.conf</span><span>&nbsp;w katalogu </span><span class="c12">/etc. </span><span>Jego domy&#347;lna zawarto&#347;&#263; zaraz po instalacji zawiera przyjazny opis opcji i ich domy&#347;lnych warto&#347;ci:</span></p><p class="c0"><span></span></p><a href="#" name="4549a986e3b158a6a1b19e6c9abc5fec4e78e258"></a><a href="#" name="0"></a><table cellpadding="0" cellspacing="0" class="c15"><tbody><tr><td class="c17"><p class="c3 c8"><span class="c1">#default server root is &quot;/usr/share/httpico/srv/&quot; (in non embedded installation)</span></p><p class="c3 c8"><span class="c1">#server_root = /usr/share/httpico/srv/</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c3 c8"><span class="c1">#default server port is 8888</span></p><p class="c3 c8"><span class="c1">#server_port = 8888</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c3 c8"><span class="c1">#default server template root is &quot;/usr/share/httpico/&quot; (in non embedded installation)</span></p><p class="c3 c8"><span class="c1">#server_template_root = /usr/share/httpico/</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c3 c8"><span class="c1">#default logging directory is &quot;/usr/share/httpico/log/&quot; (in non embedded installation)</span></p><p class="c3 c8"><span class="c1">#logging_directory = /usr/share/httpico/log/</span></p></td></tr></tbody></table><p class="c8"><span>&nbsp;</span></p><h3 class="c8"><a name="h.gmcmvq8rnsmp"></a><span>Logowanie </span></h3><p class="c8"><span>Przy ka&#380;dym uruchomieniu serwera tworzony jest plik </span><span class="c12">*.log </span><span>o nazwie wed&#322;ug schematu:</span></p><p class="c8"><span class="c1">&lt;rok&gt;-&lt;miesi&#261;c&gt;-&lt;dzie&#324;&gt;_&lt;godzina&gt;:&lt;minuta&gt;:&lt;sekunda&gt;.&lt;milisekunda&gt;.log </span></p><p class="c8"><span>Pozwala to na &#322;atw&#261; organizacj&#281; i przeszukiwanie log&oacute;w. </span></p><p class="c0"><span></span></p><p class="c8"><span>Przeanalizujmy przyk&#322;adowy rekord logu:</span></p><p class="c8"><span class="c1">INFO (2012-06-06_19:12:42.218): 127.0.0.1 &#39;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/536.5 (KHTML, like Gecko) Chrome/19.0.1084.52 Safari/536.5&#39; GET &#39;/httpico_2012-06-06_18:33:10.373.log&#39; -&gt; 200 Ok, transferred 7143 bytes</span></p><p class="c8"><span>Sk&#322;ada si&#281; on z kilku cz&#281;&#347;ci:</span></p><ol class="c9" start="1"><li class="c2"><span class="c1">INFO </span><span>- rodzaj informacji (mo&#380;e przymowa&#263; inne warto&#347;ci, np. </span><span class="c1">DEBUG</span><span>) &nbsp;</span></li><li class="c2"><span class="c1">(2012-06-06_19:12:42.218): </span><span>- aktualny </span><span class="c12">timestamp</span><span>&nbsp;</span></li><li class="c2"><span class="c1">127.0.0.1 </span><span>- adres IP klienta</span></li><li class="c2"><span class="c1">&#39;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/536.5 (KHTML, like Gecko) Chrome/19.0.1084.52 Safari/536.5&#39; </span><span>- warto&#347;&#263; nag&#322;&oacute;wka </span><span class="c12">User-Agent</span><span>&nbsp;&#380;&#261;dania </span></li><li class="c2"><span class="c1">GET </span><span>- rodzaj &#380;&#261;dania</span></li><li class="c2"><span class="c1">&#39;/httpico_2012-06-06_18:33:10.373.log&#39; </span><span>- &#380;&#261;dany zas&oacute;b </span></li><li class="c2"><span class="c1">-&gt; </span><span>- koniec informacji o &#380;&#261;daniu </span></li><li class="c2"><span class="c1">200 Ok </span><span>- kod odpowiedzi </span></li><li class="c2"><span class="c1">transferred 7143 bytes </span><span>- ilo&#347;&#263; bajt&oacute;w przes&#322;anych do klienta </span></li></ol><p class="c0"><span></span></p><h3 class="c8"><a name="h.ypapygt3ifx4"></a><span>System szablon&oacute;w </span></h3><p class="c8"><span>Serwer poszukuje w katalogu szab</span><span>lon&oacute;w pliku </span><span class="c1">template.html</span><span>, w kt&oacute;rym pierwsze wyst&#261;pienia ci&#261;g&oacute;w znak&oacute;w </span><span class="c1">{title}</span><span>&nbsp;i </span><span class="c1">{content}</span><span>&nbsp;zast&#261;pi odpowiednio przez tytu&#322; strony i jej tre&#347;&#263;. Dzi&#281;ki temu mo&#380;na by&#322;o osi&#261;gn&#261;&#263; nowoczesny wygl&#261;d stron b&#322;&#281;d&oacute;w i listing&oacute;w. Domy&#347;lnie, strona listingu katalogu mo&#380;e wygl&#261;da&#263; tak:</span><img height="417" src="images/image00.png" width="800"></p><h3 class="c8"><a name="h.he9n0setq17y"></a><span>Strony b&#322;&#281;d&oacute;w</span></h3><p class="c8"><span>System podczas napotkania b&#322;&#281;du zwraca do klienta odpowiedni kod. Przyk&#322;adowo, podczas &#380;adania nieistniej&#261;cego zasobu serwer zwraca nast&#281;puj&#261;c&#261; stron&#281; zawieraj&#261;c&#261; informacje diagnostyczne na temat &#380;&#261;dania. S&#261; to: typ &#380;&#261;dania, &#380;&#261;dany zas&oacute;b, lista nag&#322;&oacute;wk&oacute;w wraz z ich warto&#347;ciami, nazwy i warto&#347;ci zmiennych przekazanych przez &#380;&#261;dania typu GET lub POST. </span></p><p class="c8"><img height="785" src="images/image02.png" width="800"></p><p class="c0"><span></span></p><h3 class="c8"><a name="h.ycu3r9aiznhj"></a><span>Obs&#322;ugiwane pliki</span></h3><p class="c8"><span>Serwer jest w stanie poprawnie wys&#322;a&#263; do klienta tylko sko&#324;czny zbi&oacute;r zdefiniowanych w kodzie &#378;r&oacute;d&#322;owym typ&oacute;w plik&oacute;w, poniewa&#380; nale&#380;y dla ka&#380;dego typu ustali&#263; warto&#347;&#263; nag&#322;&oacute;wka </span><span class="c12">Content-Type</span><span>. Obs&#322;ugiwane rozszerzenia plik&oacute;w wraz z ich warto&#347;ci&#261; </span><span class="c12">Content-Type</span><span>&nbsp;to:</span></p><ol class="c9" start="1"><li class="c2"><span class="c1">txt - text/plain</span></li><li class="c2"><span class="c1">bmp - image/bmp</span></li><li class="c2"><span class="c1">jpg, jpeg </span><span class="c1">-</span><span class="c1">&nbsp;image/jpeg</span></li><li class="c2"><span class="c1">pdf </span><span class="c1">-</span><span class="c1">&nbsp;application/pdf</span></li><li class="c2"><span class="c1">swf </span><span class="c1">-</span><span class="c1">&nbsp;application/x-shockwave-flash</span></li><li class="c2"><span class="c1">css - text/css</span></li><li class="c2"><span class="c1">js - application/x-javascript</span></li><li class="c2"><span class="c1">png - image/png</span></li><li class="c2"><span class="c1">gif - image/gif</span></li><li class="c2"><span class="c1">htm, html - text/html</span></li><li class="c2"><span>brak rozszerzenia</span><span class="c1">&nbsp;- text/plain</span></li></ol><p class="c0"><span class="c1"></span></p><ol class="c7" start="4"><li class="c11 c8"><h2><a name="h.jzblj6bjdy1j"></a><span>Uruchamianie i instalacja</span></h2></li></ol><p class="c8"><span>Aby pobra&#263; kod &#378;r&oacute;d&#322;owy nale&#380;y wykona&#263; polecenie:</span></p><p class="c8"><span class="c1"># </span><span class="c1">git clone </span><span class="c4 c1"><a class="c10" href="https://bitbucket.org/bryq/httpico.git">https://bitbucket.org/bryq/httpico.git</a></span></p><p class="c0"><span class="c1"></span></p><p class="c8"><span>Nast&#281;pnie w folderze g&#322;&oacute;wnym projektu wykona&#263;:</span></p><p class="c8"><span class="c1"># ./configure</span></p><p class="c8"><span>Dodatkowe opcje konfiguracji to:</span></p><ol class="c9" start="1"><li class="c2"><span class="c1">--enable-embedded</span><span>&nbsp;- konfiguruje jako instalacj&#281; </span><span class="c12">embedded</span><span>&nbsp;</span></li><li class="c2"><span class="c1">--enable-debuglogs</span><span>&nbsp;- w&#322;&#261;cza logowanie diagnostyczne</span></li></ol><p class="c0"><span></span></p><p class="c8"><span>Po wykonaniu tych polece&#324; nale&#380;y skompilowa&#263; kod:</span></p><p class="c8"><span class="c1"># make</span></p><p class="c8"><span>Ko&#324;cowym krokiem jest instalacja:</span></p><p class="c8"><span class="c1"># make install </span></p><p class="c0"><span class="c1"></span></p><p class="c0"><span></span></p><p class="c0"><span></span></p><p class="c0"><span></span></p><p class="c0"><span></span></p><p class="c0"><span></span></p></body></html>